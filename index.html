
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>English Playground Â· 60 Days</title>
<meta name="description" content="60å¤©æ¯æ—¥è‡ªåŠ¨åˆ·æ–°ï¼šæœ€è‡ªç„¶ç¾å¼ã€å¥å­æ‹¼æ‹¼ä¹ã€é—ªå¡ã€åœºæ™¯å¯¹è¯ã€è·Ÿè¯»å½•éŸ³ã€‚å¸¦è¿›åº¦æ¡ä¸æ‰“å¡ã€‚"/>
<style>
:root{--bg:#0e1117;--panel:#141821;--soft:#1b2230;--line:#22304a;--text:#e7ebf1;--muted:#9fb0c9;--brand:#6aa5ff;--ok:#4caf50;--warn:#f5a524;--bad:#ef5350}
*{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:linear-gradient(160deg,#0e1117,#101423 40%,#0e1322);color:var(--text)}
header{position:sticky;top:0;background:linear-gradient(0deg,#0f1424,#0b1020);border-bottom:1px solid var(--line);padding:12px 16px;z-index:10;display:flex;justify-content:space-between;align-items:center}
h1{margin:0;font-size:18px;letter-spacing:.4px}
.badge{font-size:12px;color:#abc;background:#24324a;border:1px solid var(--line);padding:4px 8px;border-radius:10px}
main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:16px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{appearance:none;border:none;background:var(--brand);color:#061021;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
.btn.ghost{background:var(--soft);color:var(--text);border:1px solid var(--line)}
.btn.ok{background:var(--ok);color:#fff}.btn.bad{background:var(--bad);color:#fff}.btn.warn{background:var(--warn);color:#222}
.stat{background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:10px;font-size:13px;color:var(--muted)}
.tabbar{display:flex;gap:8px;flex-wrap:wrap}
.tab{appearance:none;border:1px solid var(--line);background:var(--soft);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:600}
.tab.active{background:var(--brand);border-color:transparent;color:#061021}
.q{font-size:17px;line-height:1.6}
.opt{display:block;width:100%;text-align:left;background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:10px 12px;margin-top:10px;cursor:pointer}
.opt.correct{outline:2px solid var(--ok)}.opt.wrong{outline:2px solid var(--bad)}
.pill{background:var(--soft);border:1px dashed var(--line);padding:8px 10px;border-radius:12px;display:inline-block;margin:6px 6px 0 0;cursor:pointer}
.pill.sel{background:#25324a;border-style:solid}
.drop{min-height:46px;background:var(--soft);border:1px solid var(--line);border-radius:10px;padding:8px;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.muted{color:var(--muted);font-size:13px}
.big{font-size:18px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
.hr{height:1px;background:var(--line);margin:8px 0}
footer{padding:24px 16px;text-align:center;color:var(--muted)}
.switch{display:inline-flex;gap:8px;align-items:center}
select{background:var(--soft);color:var(--text);border:1px solid var(--line);border-radius:8px;padding:6px 8px}
progress{width:180px;height:12px}
audio{width:100%}
</style>
</head>
<body>
<header>
  <h1>English Playground Â· 60 Days</h1>
  <span class="badge" id="version">v60</span>
</header>
<main>
  <section class="card row">
    <div class="tabbar">
      <button class="tab active" data-tab="daily">æ¯æ—¥ 10 åˆ†é’Ÿ</button>
      <button class="tab" data-tab="dialogs">å®ç”¨å¯¹è¯</button>
      <button class="tab" data-tab="picks">æœ€è‡ªç„¶ç¾å¼</button>
      <button class="tab" data-tab="order">å¥å­æ‹¼æ‹¼ä¹</button>
      <button class="tab" data-tab="cards">é—ªå¡</button>
      <button class="tab" data-tab="shadow">è·Ÿè¯» Â· å½•éŸ³</button>
    </div>
    <span class="stat">Day <b id="dayNum">1</b> / 60</span>
    <span class="stat">Streak <b id="streak">0</b> å¤©</span>
    <span class="stat">å®Œæˆåº¦ <progress id="prog" max="100" value="0"></progress> <b id="progText">0%</b></span>
  </section>

  <section id="daily" class="card">
    <div class="q big">ä»Šæ—¥ä»»åŠ¡ï¼š</div>
    <ol id="dailyList"></ol>
    <div class="row"><button class="btn ok" id="btnDone">å®Œæˆä»Šå¤© âœ…</button><span class="stat">ä»Šæ—¥å·²å®Œæˆï¼š<b id="doneToday">å¦</b></span></div>
    <div class="hr"></div><div class="muted">æ¯å¤©åŒ…å«ï¼šâ‘  2é¢˜â€œæœ€è‡ªç„¶ç¾å¼â€ â‘¡ 1å¥â€œæ‹¼æ‹¼ä¹â€ â‘¢ 5å¼ â€œé—ªå¡â€ â‘£ 1æ®µâ€œå¯¹è¯è·Ÿè¯»â€ã€‚</div>
  </section>

  <section id="dialogs" class="card" style="display:none">
    <div class="row"><label>æƒ…å¢ƒï¼š</label>
      <select id="dlgScene"><option value="travel">æ—…è¡Œ/æœºåœº</option><option value="shopping">è´­ç‰©/å•†åœº</option><option value="daily">æ—¥å¸¸/å¯’æš„</option><option value="restaurant">é¤é¦†/ç‚¹é¤</option><option value="work">èŒåœº/é‚®ä»¶</option></select>
      <span class="switch"><label>å£éŸ³ï¼š</label><select id="accent"><option value="us">ç¾å¼</option><option value="uk">è‹±å¼</option></select></span>
      <button class="btn" id="dlgPlay">ğŸ”Š æœ—è¯»</button></div>
    <div id="dlgBox" class="grid"></div>
  </section>

  <section id="picks" class="card" style="display:none">
    <div class="q" id="mcQ"></div><div id="mcOpts"></div><div class="muted" id="mcHint"></div>
    <div class="row" style="margin-top:10px"><button class="btn" id="mcNext">ä¸‹ä¸€é¢˜ â–¶</button><span class="stat">æ­£ç¡® <b id="mcRight">0</b> / <b id="mcTotal">0</b></span></div>
  </section>

  <section id="order" class="card" style="display:none">
    <div class="q" id="odQ"></div><div class="muted">ç‚¹å‡»è¯å—æ’å¥ï¼ˆå†ç‚¹å¯å–æ¶ˆï¼‰ã€‚</div>
    <div class="drop" id="odDrop" style="margin-top:8px"></div><div id="odPool" style="margin-top:8px"></div>
    <div class="row" style="margin-top:10px"><button class="btn ok" id="odCheck">æ£€æŸ¥</button><button class="btn ghost" id="odNext">ä¸‹ä¸€å¥ â–¶</button><span class="stat">æ­£ç¡® <b id="odRight">0</b> / <b id="odTotal">0</b></span></div>
    <div class="muted" id="odHint"></div>
  </section>

  <section id="cards" class="card" style="display:none">
    <div class="q big" id="fcFront"></div><div class="muted" id="fcBack" style="display:none;margin-top:6px"></div>
    <div class="row" style="margin-top:12px"><button class="btn ghost" id="fcFlip">æ˜¾ç¤ºé‡Šä¹‰</button><button class="btn bad" id="fcUnsure">Unsure</button><button class="btn ok" id="fcKnow">Know</button><span class="stat">å·²æŒæ¡ <b id="fcKnown">0</b></span></div>
  </section>

  <section id="shadow" class="card" style="display:none">
    <div class="q" id="shLine">Let's head out before it gets dark.</div>
    <div class="row"><button class="btn" id="shSpeak">ğŸ”Š TTS</button><button class="btn" id="shRecord">âº å½•éŸ³</button><button class="btn ghost" id="shStop" disabled>â–  åœæ­¢</button><a id="shDownload" class="btn ghost" href="#" download="shadow.webm" style="display:none">ä¸‹è½½å½•éŸ³</a></div>
    <audio id="shAudio" controls style="margin-top:10px;display:none"></audio>
    <div class="muted">å½•éŸ³ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ ã€‚</div>
  </section>
</main>
<footer>Â© 2025 English Playground Â· v60 Â· 60å¤©è‡ªåŠ¨æ¢é¢˜</footer>

<script>
const storeKey="eng-playground-v60";
const S=JSON.parse(localStorage.getItem(storeKey)||"{}"); function save(){localStorage.setItem(storeKey,JSON.stringify(S));}

// Tabs
document.querySelectorAll(".tab").forEach(b=>{
  b.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    for(const id of ["daily","dialogs","picks","order","cards","shadow"]) document.getElementById(id).style.display="none";
    document.getElementById(b.dataset.tab).style.display="";
  });
});

// Date & Day index (1..60)
const today = new Date();
const base = new Date("2025-01-01");
const diffDays = Math.floor((today - base)/(24*3600*1000));
const dayIdx = (diffDays % 60 + 60) % 60; // 0..59
document.getElementById("dayNum").textContent = (dayIdx+1);

// Streak
if(!S.streak){S.streak=0; S.lastDone=""; S.completed={}}
function updateStreakUI(){ document.getElementById("streak").textContent=S.streak; document.getElementById("doneToday").textContent=(S.lastDone===today.toDateString()?"æ˜¯":"å¦"); }
updateStreakUI();
document.getElementById("btnDone").onclick=()=>{
  if (S.lastDone!==today.toDateString()){ S.streak = (S.lastDone && (new Date(S.lastDone).getTime()+86400000=== new Date(today.toDateString()).getTime())) ? (S.streak+1) : (S.streak?S.streak+1:1); S.lastDone=today.toDateString(); save(); }
  updateStreakUI(); updateProgress();
};

// Data pools (sample extended set; real 60d uses rotations)
const MC_POOL = [
 {q:"å»æ—…è¡Œï¼ˆæœ€è‡ªç„¶ç¾å¼ï¼‰",opts:["I had a travel.","I went on a trip.","I made a travel."],answer:1,why:"travelå¤šä¸ºä¸å¯æ•°ï¼›go on/take a trip æ›´è‡ªç„¶ã€‚"},
 {q:"å¶é‡æŸäººï¼ˆå£è¯­ï¼‰",opts:["I ran into her.","I met her by coincidence.","I bumped her into."],answer:0,why:"run into / bump into = å¶é‡ã€‚"},
 {q:"ç»™æŸäººæ­è½¦ï¼ˆç¾å¼ï¼‰",opts:["give sb a rider","give sb a ride","give sb a lift"],answer:1,why:"give sb a rideï¼ˆç¾å¼ï¼‰ï¼Œlift åè‹±å¼ã€‚"},
 {q:"ç‚¹é¤ç¤¼è²Œè¡¨è¾¾",opts:["I want chicken.","I'll have the chicken.","Give me the chicken."],answer:1,why:"I'll have ... æœ€è‡ªç„¶ç¤¼è²Œã€‚"},
 {q:"é—®è·¯æ›´è‡ªç„¶",opts:["How to subway?","How do I get to the subway station?","Where subway?"],answer:1,why:"How do I get to ..."},
 {q:"è™½ç„¶/å°½ç®¡",opts:["Though it was raining, we still went.","Although it's raining, we still go.","Even though it's rains."],answer:0,why:"è¯­æ³•ä¸æ—¶æ€ä¸€è‡´ï¼Œ1æœ€è‡ªç„¶ã€‚"}
];
const ORDER_POOL = [
 {q:"æŒ‰é¡ºåºï¼šä¸¤ä¸ªæœˆå‰æˆ‘ä»¬å»æ—¥æœ¬æ—…è¡Œã€‚", ans:"Two months ago , my wife and I took a trip to Japan ."},
 {q:"æŒ‰é¡ºåºï¼šæˆ‘ä»¬å¤©é»‘å‰å‡ºå‘å§ã€‚", ans:"Let's head out before it gets dark ."},
 {q:"æŒ‰é¡ºåºï¼šå¥¹åœ¨æ´¾å¯¹åé€æˆ‘å›å®¶ã€‚", ans:"She gave me a ride home after the party ."},
 {q:"æŒ‰é¡ºåºï¼šè¯·é—®åˆ°åœ°é“ç«™æ€ä¹ˆèµ°ï¼Ÿ", ans:"How do I get to the subway station ?"}
];
const CARDS_POOL = [
 {front:"head out",back:"å‡ºå‘ã€åŠ¨èº«ï¼ˆå£è¯­ï¼‰"},
 {front:"give sb a ride",back:"è½½æŸäººä¸€ç¨‹ï¼ˆç¾å¼ï¼‰"},
 {front:"go/come over",back:"ï¼ˆå£è¯­ï¼‰è·¨è¿‡å»/è¿‡æ¥"},
 {front:"run/bump into",back:"å¶é‡æŸäºº"},
 {front:"go on / take a trip",back:"å»æ—…è¡Œ"},
 {front:"drop sb off",back:"æŠŠæŸäººé€åˆ°æŸå¤„"},
 {front:"pick sb up",back:"å»æ¥æŸäºº"},
 {front:"I'll have ...",back:"ç‚¹é¤ç¤¼è²Œè¡¨è¾¾"},
 {front:"restroom / bathroom",back:"ç¾å¼â€œæ´—æ‰‹é—´â€"},
 {front:"receipt / invoice",back:"æ”¶æ® / å‘ç¥¨ï¼ˆè´­ç‰©ï¼‰"}
];
const DIALOGS = {
 travel:[
  {en:"Excuse me, whereâ€™s the check-in counter for Japan Airlines?",cn:"æ‰“æ‰°ä¸€ä¸‹ï¼Œæ—¥æœ¬èˆªç©ºçš„å€¼æœºæŸœå°åœ¨å“ªé‡Œï¼Ÿ"},
  {en:"How many bags are you checking?",cn:"æ‚¨è¦æ‰˜è¿å‡ ä¸ªè¡Œæï¼Ÿ"},
  {en:"Just one. Can I keep this power bank in my carry-on?",cn:"å°±ä¸€ä¸ªã€‚è¿™ä¸ªå……ç”µå®å¯ä»¥éšèº«å¸¦å—ï¼Ÿ"}
 ],
 shopping:[
  {en:"Do you have this in medium?",cn:"è¿™ä»¶æœ‰ M ç å—ï¼Ÿ"},
  {en:"Can I try it on?",cn:"å¯ä»¥è¯•ç©¿å—ï¼Ÿ"},
  {en:"Is there any discount on this item?",cn:"è¿™ä»¶æœ‰æŠ˜æ‰£å—ï¼Ÿ"}
 ],
 daily:[
  {en:"Hey, long time no see!",cn:"å˜¿ï¼Œå¥½ä¹…ä¸è§ï¼"},
  {en:"Guess who I ran into yesterday.",cn:"çŒœçŒœæˆ‘æ˜¨å¤©å¶é‡äº†è°ã€‚"},
  {en:"No wayâ€”who?",cn:"ä¸ä¼šå§â€”â€”è°ï¼Ÿ"}
 ],
 restaurant:[
  {en:"Table for two, please.",cn:"æˆ‘ä»¬ä¸¤ä½ã€‚"},
  {en:"I'll have the chicken.",cn:"æˆ‘è¦é¸¡è‚‰ã€‚"},
  {en:"Could we get the check, please?",cn:"è¯·ç»“è´¦ã€‚"}
 ],
 work:[
  {en:"I replied to my boss's email yesterday afternoon.",cn:"æˆ‘æ˜¨å¤©ä¸‹åˆå›å¤äº†è€æ¿çš„é‚®ä»¶ã€‚"},
  {en:"Could you drop by my desk later?",cn:"å¾…ä¼šå„¿åˆ°æˆ‘å·¥ä½ä¸€ä¸‹ï¼Ÿ"},
  {en:"Let's head out after the meeting.",cn:"ä¼šåæˆ‘ä»¬å‡ºå‘å§ã€‚"}
 ]
};

// Simple deterministic picker based on dayIdx
function pickN(arr, n){
  const out=[]; for(let i=0;i<n;i++){ out.push(arr[(dayIdx*7 + i*3) % arr.length]); } return out;
}

// Build daily sets
const MC = pickN(MC_POOL, 2);
const ORDER = pickN(ORDER_POOL, 1);
const CARDS = pickN(CARDS_POOL, 5);
const D_SCENES = ["travel","shopping","daily","restaurant","work"];
const scene = D_SCENES[ dayIdx % D_SCENES.length ];

// Render daily list
const dailyItems=[
 `æœ€è‡ªç„¶ç¾å¼ Ã— ${MC.length}`,
 `å¥å­æ‹¼æ‹¼ä¹ Ã— ${ORDER.length}`,
 `é—ªå¡ Ã— ${CARDS.length}`,
 `å¯¹è¯è·Ÿè¯»ï¼ˆ${scene}ï¼‰ Ã— 1`
];
const dl=document.getElementById("dailyList"); dailyItems.forEach(t=>{ const li=document.createElement("li"); li.textContent=t; dl.appendChild(li); });

// MC
let mcIdx=0, mcRight=S.mcRight||0, mcTotal=S.mcTotal||0;
const mcQ=document.getElementById("mcQ"), mcOpts=document.getElementById("mcOpts"), mcHint=document.getElementById("mcHint");
const mcRightEl=document.getElementById("mcRight"), mcTotalEl=document.getElementById("mcTotal");
function renderMC(){ const item=MC[mcIdx%MC.length]; mcQ.textContent="Q: "+item.q; mcOpts.innerHTML=""; mcHint.textContent="";
  item.opts.forEach((t,i)=>{ const btn=document.createElement("button"); btn.className="opt"; btn.textContent=t;
    btn.onclick=()=>{ const ok=i===item.answer; btn.classList.add(ok?"correct":"wrong"); mcHint.textContent=(ok?"âœ… æ­£ç¡®ã€‚":"âŒ å†æƒ³æƒ³ã€‚")+" è§£é‡Šï¼š"+item.why; mcTotal++; if(ok) mcRight++; mcRightEl.textContent=mcRight; mcTotalEl.textContent=mcTotal; S.mcRight=mcRight; S.mcTotal=mcTotal; save(); mcOpts.querySelectorAll("button").forEach(b=>b.disabled=true); updateProgress(); };
    mcOpts.appendChild(btn);
  });
  mcRightEl.textContent=mcRight; mcTotalEl.textContent=mcTotal;
}
document.getElementById("mcNext").onclick=()=>{ mcIdx++; renderMC(); updateProgress(); };
renderMC();

// ORDER
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
let odIdx=0, odRight=S.odRight||0, odTotal=S.odTotal||0;
const odQ=document.getElementById("odQ"), odDrop=document.getElementById("odDrop"), odPool=document.getElementById("odPool");
const odRightEl=document.getElementById("odRight"), odTotalEl=document.getElementById("odTotal"), odHint=document.getElementById("odHint");
function renderOD(){ const item=ORDER[odIdx%ORDER.length]; odQ.textContent="Q: "+item.q; odDrop.innerHTML=""; odHint.textContent="";
  const toks=item.ans.split(" ").filter(x=>x.length); const pool=shuffle(toks.slice()); odPool.innerHTML="";
  pool.forEach(t=>{ const p=document.createElement("button"); p.className="pill"; p.textContent=t;
    p.onclick=()=>{ if(p.classList.contains("sel")){ const m=Array.from(odDrop.children).find(x=>x.dataset.id===p.dataset.id); if(m) m.remove(); p.classList.remove("sel"); }
      else{ const s=document.createElement("span"); s.className="pill sel"; s.textContent=t; s.dataset.id=p.dataset.id=Math.random().toString(36).slice(2); odDrop.appendChild(s); p.classList.add("sel"); } updateProgress(); };
    odPool.appendChild(p);
  });
  odRightEl.textContent=odRight; odTotalEl.textContent=odTotal;
}
document.getElementById("odCheck").onclick=()=>{ const item=ORDER[odIdx%ORDER.length]; const guess=Array.from(odDrop.children).map(x=>x.textContent).join(" "); const ok=guess===item.ans; odHint.textContent=ok?"âœ… å®Œç¾ï¼":"âŒ æ­£ç¡®ç­”æ¡ˆï¼š"+item.ans; odTotal++; if(ok) odRight++; odRightEl.textContent=odRight; odTotalEl.textContent=odTotal; S.odRight=odRight; S.odTotal=odTotal; save(); updateProgress(); };
document.getElementById("odNext").onclick=()=>{ odIdx++; renderOD(); updateProgress(); };
renderOD();

// CARDS
let fcIdx=0, known=S.known||{}; const fcFront=document.getElementById("fcFront"), fcBack=document.getElementById("fcBack"), fcKnown=document.getElementById("fcKnown");
function renderFC(){ const item=CARDS[fcIdx%CARDS.length]; fcFront.textContent=item.front; fcBack.textContent=item.back; fcBack.style.display="none"; fcKnown.textContent=Object.values(known).filter(Boolean).length; }
document.getElementById("fcFlip").onclick=()=>{ fcBack.style.display=(fcBack.style.display==="none"?"":"none"); };
document.getElementById("fcUnsure").onclick=()=>{ known[CARDS[fcIdx%CARDS.length].front]=false; S.known=known; save(); fcIdx++; renderFC(); updateProgress(); };
document.getElementById("fcKnow").onclick=()=>{ known[CARDS[fcIdx%CARDS.length].front]=true; S.known=known; save(); fcIdx++; renderFC(); updateProgress(); };
renderFC();

// Dialogs + TTS
const dlgBox=document.getElementById("dlgBox"); const dlgScene=document.getElementById("dlgScene"); const accentSel=document.getElementById("accent");
function renderDlg(){ dlgBox.innerHTML=""; const arr=DIALOGS[dlgScene.value]; arr.forEach(line=>{ const div=document.createElement("div"); div.className="card"; div.innerHTML="<b>"+line.en+"</b><div class='muted' style='display:none'>"+line.cn+"</div>"; div.onclick=()=>{ const m=div.querySelector('.muted'); m.style.display = (m.style.display==='none'?'':'none'); }; dlgBox.appendChild(div); }); }
renderDlg(); dlgScene.value=scene; renderDlg();
document.getElementById("dlgPlay").onclick=()=>{ const arr=DIALOGS[dlgScene.value]; const utter=t=>{ const u=new SpeechSynthesisUtterance(t); u.rate=1.0; u.pitch=1.0; u.lang=accentSel.value==='us'?'en-US':'en-GB'; speechSynthesis.speak(u); }; arr.forEach((line,i)=>{ setTimeout(()=>utter(line.en), i*1500); }); };

// Shadow record
const shLine=document.getElementById("shLine"); const shSpeak=document.getElementById("shSpeak"); const shRecord=document.getElementById("shRecord"); const shStop=document.getElementById("shStop"); const shAudio=document.getElementById("shAudio"); const shDownload=document.getElementById("shDownload");
shSpeak.onclick=()=>{ const u=new SpeechSynthesisUtterance(shLine.textContent); u.lang='en-US'; speechSynthesis.speak(u); };
let mediaRec, chunks=[];
shRecord.onclick=async()=>{ try{ const stream=await navigator.mediaDevices.getUserMedia({audio:true}); mediaRec=new MediaRecorder(stream); chunks=[]; mediaRec.ondataavailable=e=>chunks.push(e.data);
  mediaRec.onstop=()=>{ const blob=new Blob(chunks,{type:"audio/webm"}); const url=URL.createObjectURL(blob); shAudio.src=url; shAudio.style.display=''; shDownload.href=url; shDownload.style.display='inline-block'; };
  mediaRec.start(); shRecord.disabled=true; shStop.disabled=false; } catch(e){ alert("å½•éŸ³å¤±è´¥ï¼ˆæµè§ˆå™¨æœªæˆæƒ/ä¸æ”¯æŒï¼‰ã€‚"); } };
shStop.onclick=()=>{ if(mediaRec && mediaRec.state!=='inactive'){ mediaRec.stop(); shRecord.disabled=false; shStop.disabled=true; } };

// Progress (MC:2, ORDER:1, CARDS:5, DIALOG:1, Shadow optional)
function updateProgress(){
  let done=0, total=2+1+5+1;
  // MC counted when mcIdx advanced beyond last and at least answered one in this session
  done += Math.min(mcIdx, 2);
  // ORDER: mark as done if any check attempted
  done += (odTotal>0?1:0);
  // CARDS: up to 5 interactions
  done += Math.min(Object.values(known).length, 5);
  // Dialog: play button as done once clicked
  done += (S.dialogPlayed?1:0);
  const percent=Math.round(done/total*100);
  document.getElementById("prog").value=percent; document.getElementById("progText").textContent=percent+"%";
}
updateProgress();
document.getElementById("dlgPlay").addEventListener("click", ()=>{ S.dialogPlayed=true; save(); updateProgress(); });
</script>
</body>
</html>
