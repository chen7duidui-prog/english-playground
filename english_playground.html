
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>English Playground Â· è¶£å‘³è‹±è¯­åœ¨çº¿</title>
<meta name="description" content="ä¸€ä¸ªè½»é‡ã€å¥½ç©çš„è‹±è¯­å°ç½‘é¡µï¼šæ¯æ—¥10åˆ†é’Ÿè·¯å¾„ã€åœ°é“å£è¯­ã€å®ç”¨å¯¹è¯ã€é—ªå¡ã€å¥å­æ‹¼æ‹¼ä¹ã€è·Ÿè¯»å½•éŸ³ã€‚å•æ–‡ä»¶ã€å¯ç¦»çº¿ã€å¯ä¸€é”®éƒ¨ç½²ä¸ºåœ¨çº¿é“¾æ¥ã€‚" />
<style>
:root{--bg:#0e1117;--panel:#141821;--soft:#1b2230;--line:#22304a;--text:#e7ebf1;--muted:#9fb0c9;--brand:#6aa5ff;--ok:#4caf50;--warn:#f5a524;--bad:#ef5350}
*{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:linear-gradient(160deg,#0e1117,#101423 40%,#0e1322);color:var(--text)}
header{position:sticky;top:0;background:linear-gradient(0deg,#0f1424,#0b1020);border-bottom:1px solid var(--line);padding:14px 16px;z-index:10}
h1{margin:0;font-size:18px;letter-spacing:.4px}
main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:16px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{appearance:none;border:none;background:var(--brand);color:#061021;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
.btn.ghost{background:var(--soft);color:var(--text);border:1px solid var(--line)}
.btn.ok{background:var(--ok);color:#fff}.btn.bad{background:var(--bad);color:#fff}.btn.warn{background:var(--warn);color:#222}
.stat{background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:10px;font-size:13px;color:var(--muted)}
.tabbar{display:flex;gap:8px;flex-wrap:wrap}
.tab{appearance:none;border:1px solid var(--line);background:var(--soft);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:600}
.tab.active{background:var(--brand);border-color:transparent;color:#061021}
.q{font-size:17px;line-height:1.6}
.opt{display:block;width:100%;text-align:left;background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:10px 12px;margin-top:10px;cursor:pointer}
.opt.correct{outline:2px solid var(--ok)}.opt.wrong{outline:2px solid var(--bad)}
.pill{background:var(--soft);border:1px dashed var(--line);padding:8px 10px;border-radius:12px;display:inline-block;margin:6px 6px 0 0;cursor:pointer}
.pill.sel{background:#25324a;border-style:solid}
.drop{min-height:46px;background:var(--soft);border:1px solid var(--line);border-radius:10px;padding:8px;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.muted{color:var(--muted);font-size:13px}
.big{font-size:18px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
.hr{height:1px;background:var(--line);margin:8px 0}
footer{padding:24px 16px;text-align:center;color:var(--muted)}
.switch{display:inline-flex;gap:8px;align-items:center}
select,textarea,input[type=text]{background:var(--soft);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px}
audio{width:100%}
</style>
</head>
<body>
<header><h1>English Playground Â· è¶£å‘³è‹±è¯­åœ¨çº¿</h1></header>
<main>
  <section class="card row">
    <div class="tabbar">
      <button class="tab active" data-tab="daily">æ¯æ—¥ 10 åˆ†é’Ÿ</button>
      <button class="tab" data-tab="dialogs">å®ç”¨å¯¹è¯</button>
      <button class="tab" data-tab="picks">æœ€è‡ªç„¶ç¾å¼</button>
      <button class="tab" data-tab="order">å¥å­æ‹¼æ‹¼ä¹</button>
      <button class="tab" data-tab="cards">é—ªå¡</button>
      <button class="tab" data-tab="shadow">è·Ÿè¯» Â· å½•éŸ³</button>
      <button class="tab" data-tab="settings">è®¾ç½®</button>
      <button class="tab" data-tab="publish">ä¸Šçº¿è¯´æ˜</button>
    </div>
    <span class="stat">Streak <b id="streak">0</b> å¤©</span>
    <span class="stat">ç›®æ ‡ï¼šæ¯å¤© 10 åˆ†é’Ÿ Â· æœ‰è¶£ä¸æ¯ç‡¥</span>
  </section>

  <section id="daily" class="card">
    <div class="q big">ä»Šæ—¥ä»»åŠ¡ï¼ˆè‡ªåŠ¨è½®æ¢ï¼‰ï¼š</div>
    <ol id="dailyList"></ol>
    <div class="row"><button class="btn ok" id="btnDone">å®Œæˆä»Šå¤© âœ…</button><span class="stat">ä»Šæ—¥å·²å®Œæˆï¼š<b id="doneToday">å¦</b></span></div>
    <div class="hr"></div><div class="muted">æ¯æ—¥åŒ…å«ï¼šâ‘  2é¢˜â€œæœ€è‡ªç„¶ç¾å¼â€ â‘¡ 1å¥â€œæ‹¼æ‹¼ä¹â€ â‘¢ 5å¼ é—ªå¡ â‘£ 1æ®µâ€œè·Ÿè¯»â€ã€‚</div>
  </section>

  <section id="dialogs" class="card" style="display:none">
    <div class="row"><label>æƒ…å¢ƒï¼š</label>
      <select id="dlgScene"><option value="travel">æ—…è¡Œ/æœºåœº</option><option value="smalltalk">å¯’æš„/é—²èŠ</option><option value="restaurant">é¤é¦†ç‚¹é¤</option><option value="work">èŒåœº/é‚®ä»¶</option></select>
      <span class="switch"><label>å£éŸ³ï¼š</label><select id="accent"><option value="us">ç¾å¼</option><option value="uk">è‹±å¼</option></select></span>
      <button class="btn" id="dlgPlay">ğŸ”Š æœ—è¯»</button></div>
    <div id="dlgBox" class="grid"></div><div class="muted">ç‚¹â€œæœ—è¯»â€ç”¨ç³»ç»Ÿ TTS å‘éŸ³ï¼›å¯åå¤ç»ƒè·Ÿè¯»ã€‚</div>
  </section>

  <section id="picks" class="card" style="display:none">
    <div class="q" id="mcQ"></div><div id="mcOpts"></div><div class="muted" id="mcHint"></div>
    <div class="row" style="margin-top:10px"><button class="btn" id="mcNext">ä¸‹ä¸€é¢˜ â–¶</button><span class="stat">æ­£ç¡® <b id="mcRight">0</b> / <b id="mcTotal">0</b></span></div>
  </section>

  <section id="order" class="card" style="display:none">
    <div class="q" id="odQ"></div><div class="muted">ç‚¹å‡»è¯å—æ’å¥ï¼ˆå†ç‚¹å¯å–æ¶ˆï¼‰ã€‚</div>
    <div class="drop" id="odDrop" style="margin-top:8px"></div><div id="odPool" style="margin-top:8px"></div>
    <div class="row" style="margin-top:10px"><button class="btn ok" id="odCheck">æ£€æŸ¥</button><button class="btn ghost" id="odNext">ä¸‹ä¸€å¥ â–¶</button><span class="stat">æ­£ç¡® <b id="odRight">0</b> / <b id="odTotal">0</b></span></div>
    <div class="muted" id="odHint"></div>
  </section>

  <section id="cards" class="card" style="display:none">
    <div class="q big" id="fcFront"></div><div class="muted" id="fcBack" style="display:none;margin-top:6px"></div>
    <div class="row" style="margin-top:12px"><button class="btn ghost" id="fcFlip">æ˜¾ç¤ºé‡Šä¹‰</button><button class="btn bad" id="fcUnsure">Unsure</button><button class="btn ok" id="fcKnow">Know</button><span class="stat">å·²æŒæ¡ <b id="fcKnown">0</b></span></div>
  </section>

  <section id="shadow" class="card" style="display:none">
    <div class="q" id="shLine">Let's head out before it gets dark.</div>
    <div class="row"><button class="btn" id="shSpeak">ğŸ”Š TTS</button><button class="btn" id="shRecord">âº å½•éŸ³</button><button class="btn ghost" id="shStop" disabled>â–  åœæ­¢</button><a id="shDownload" class="btn ghost" href="#" download="shadow.wav" style="display:none">ä¸‹è½½å½•éŸ³</a></div>
    <audio id="shAudio" controls style="margin-top:10px;display:none"></audio><div class="muted">ä¸ä¸Šä¼ æœåŠ¡å™¨ï¼Œå½•éŸ³åªåœ¨æœ¬åœ°ï¼›å¯ä¸‹è½½å›æ”¾ã€‚</div>
  </section>

  <section id="settings" class="card" style="display:none">
    <div class="row"><span class="switch"><label>æ¯æ—¥ç›®æ ‡ï¼ˆåˆ†é’Ÿï¼‰</label><select id="goal"><option>10</option><option>15</option><option>20</option></select></span><button class="btn ghost" id="reset">æ¸…ç©ºè¿›åº¦</button></div>
    <div class="hr"></div><div class="muted">å°è´´å£«ï¼šå°†æœ¬é¡µéƒ¨ç½²åˆ° GitHub Pages/Netlifyï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªåœ¨çº¿é“¾æ¥ï¼Œéšæ—¶å­¦ã€éšæ—¶åˆ†äº«ã€‚</div>
  </section>

  <section id="publish" class="card" style="display:none">
    <div class="q big">æŠŠè¿™ä¸ªé¡µé¢â€œä¸Šçº¿â€ä¸ºä¸€ä¸ªå¯ç›´æ¥æ‰“å¼€çš„é“¾æ¥ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰</div>
    <ol>
      <li>å» <b>github.com</b> æ–°å»ºä¸€ä¸ªå…¬å¼€ä»“åº“ï¼ˆæ¯”å¦‚ <code>english-playground</code>ï¼‰ã€‚</li>
      <li>ä¸Šä¼  <code>index.html</code>ï¼ˆæˆ–æ•´ä¸ªå‹ç¼©åŒ…è§£å‹åçš„æ‰€æœ‰æ–‡ä»¶ï¼‰ã€‚</li>
      <li>åœ¨ä»“åº“è®¾ç½®é‡Œæ‰¾åˆ° <b>Pages</b> â†’ Source é€‰ <b>Deploy from a branch</b>ï¼Œåˆ†æ”¯é€‰ <b>main</b>ï¼Œç›®å½•é€‰ <b>/root</b>ï¼Œä¿å­˜ã€‚</li>
      <li>å‡ åˆ†é’Ÿåä¼šå‡ºç°ä¸€ä¸ªç½‘å€ï¼Œå½¢å¦‚ <code>https://ä½ çš„ç”¨æˆ·å.github.io/english-playground/</code>ã€‚</li>
    </ol>
  </section>
</main>
<footer>Â© 2025 English Playground Â· å•æ–‡ä»¶ / å¯ç¦»çº¿ / ä¸€é”®éƒ¨ç½²</footer>

<script>
const storeKey="eng-playground-v1"; const S=JSON.parse(localStorage.getItem(storeKey)||"{}"); function save(){localStorage.setItem(storeKey,JSON.stringify(S));}
document.querySelectorAll(".tab").forEach(b=>{b.addEventListener("click",()=>{document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));b.classList.add("active");for(const id of ["daily","dialogs","picks","order","cards","shadow","settings","publish"])document.getElementById(id).style.display="none";document.getElementById(b.dataset.tab).style.display="";});});
const today=new Date().toISOString().slice(0,10); if(!S.streak){S.streak=0;S.lastDone="";} function uStreak(){document.getElementById("streak").textContent=S.streak;document.getElementById("doneToday").textContent=(S.lastDone===today?"æ˜¯":"å¦");} uStreak();
document.getElementById("btnDone").onclick=()=>{if(S.lastDone!==today){S.streak=(S.lastDone&& (new Date(S.lastDone).getTime()+86400000===new Date(today).getTime()))?(S.streak+1):(S.streak?S.streak+1:1);S.lastDone=today;save();}uStreak();};
const dailyItems=["åš 2 é¢˜ã€Œæœ€è‡ªç„¶ç¾å¼ã€â†’ æ‰“å¼€ä¸Šæ–¹â€œæœ€è‡ªç„¶ç¾å¼â€","å®Œæˆ 1 å¥ã€Œå¥å­æ‹¼æ‹¼ä¹ã€","åˆ· 5 å¼ ã€Œé—ªå¡ã€","åœ¨ã€Œå®ç”¨å¯¹è¯ã€é‡Œè·Ÿè¯» 1 æ®µï¼ˆç‚¹ ğŸ”Šï¼‰"]; const dl=document.getElementById("dailyList"); dailyItems.forEach(t=>{const li=document.createElement("li"); li.textContent=t; dl.appendChild(li);});

const MC=[
 {q:"æœ€è‡ªç„¶çš„ç¾å¼ï¼šæˆ‘ä¸¤ä¸ªæœˆå‰å»æ—¥æœ¬æ—…è¡Œäº†ä¸€è¶Ÿã€‚",opts:["Two months ago, I had a travel to Japan.","Two months ago, I went on a trip to Japan.","Two months ago, I made a travel to Japan."],answer:1,why:"travel å¤šä¸ºä¸å¯æ•°ï¼›go on/take a trip æ›´è‡ªç„¶ã€‚"},
 {q:"æ›´å£è¯­ï¼šæˆ‘å¶é‡äº†å¥¹ã€‚",opts:["I ran into her.","I met her by coincidence.","I bumped her into."],answer:0,why:"run into / bump into = å¶é‡ï¼›bump her into è¯­æ³•é”™ã€‚"},
 {q:"æ›´è‡ªç„¶ï¼ˆç¾å¼ï¼‰ï¼šå¥¹æœæˆ‘æŒ¥æ‰‹å¹¶å–Šäº†æˆ‘çš„åå­—ã€‚",opts:["She waved to me and shouted my name.","She waved at me and called out my name.","She waved me and yelled my name."],answer:1,why:"ç¾å¼å¸¸è¯´ wave at sbï¼›å«åå­—æ›´è‡ªç„¶ç”¨ call outã€‚"},
 {q:"é€‰æ‹©ï¼šæˆ‘æ˜¨å¤©é€èµµä¸€ç¨‹ã€‚",opts:["I gave Zhao a rider yesterday.","I gave Zhao a ride yesterday.","I gave Zhao a lift yesterday."],answer:1,why:"give sb a rideï¼ˆç¾å¼ï¼‰ï¼›lift åè‹±å¼ï¼›rider=ä¹˜å®¢ã€‚"},
 {q:"è™½ç„¶/å°½ç®¡çš„è‡ªç„¶ç”¨æ³•ï¼š",opts:["Even though it was raining, we still went.","Though it was raining, we still went.","Although it's raining, we still go."],answer:1,why:"2 æœ€è‡ªç„¶ï¼›1 è¯­æ°”æ›´å¼ºï¼›3 æ—¶æ€ä¸ä¸€è‡´ã€‚"},
 {q:"home åœ¨å“ªå¥é‡Œæ˜¯å‰¯è¯ï¼ˆåˆ°å®¶ï¼‰ï¼š",opts:["I drove her to home.","I drove her home.","I stayed at the home."],answer:1,why:"drive sb home ä¸­ home ä½œå‰¯è¯ï¼›to home ä¸è‡ªç„¶ã€‚"},
 {q:"å£è¯­â€œè·¨è¿‡å»åˆ°é‚£è¾¹â€ï¼š",opts:["We went over to Japan last year.","We went to Japan over.","We over went to Japan."],answer:0,why:"go over to + åœ°ç‚¹ã€‚"},
 {q:"é¤é¦†ç‚¹é¤æ›´è‡ªç„¶ï¼š",opts:["I want chicken.","Iâ€™ll have the chicken.","Give me chicken."],answer:1,why:"ç‚¹é¤å¸¸ç”¨ I'll have ...ï¼ˆç¤¼è²Œè‡ªç„¶ï¼‰ã€‚"},
 {q:"é—®è·¯ï¼šåˆ°åœ°é“ç«™æ€ä¹ˆèµ°ï¼Ÿ",opts:["How to subway?","How do I get to the subway station?","Where subway?"],answer:1,why:"How do I get to ... ä¸ºæœ€è‡ªç„¶é—®è·¯è¡¨è¾¾ã€‚"},
];

const ORDER=[
 {q:"æŒ‰é¡ºåºï¼šä¸¤ä¸ªæœˆå‰æˆ‘å’Œæˆ‘è€å©†å»æ—¥æœ¬æ—…è¡Œäº†ä¸€è¶Ÿã€‚",ans:"Two months ago , my wife and I took a trip to Japan ."},
 {q:"æŒ‰é¡ºåºï¼šè™½ç„¶ä¸‹é›¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯å»äº†ã€‚",ans:"Though it was raining , we still went ."},
 {q:"æŒ‰é¡ºåºï¼šèšä¼šç»“æŸåå¥¹é€æˆ‘å›å®¶ã€‚",ans:"She gave me a ride home after the party ."},
 {q:"æŒ‰é¡ºåºï¼šæˆ‘ä»¬åœ¨å¤©é»‘å‰å‡ºå‘å§ã€‚",ans:"Let's head out before it gets dark ."},
 {q:"æŒ‰é¡ºåºï¼šè¯·é—®æˆ‘ä»¬å¯ä»¥åçª—è¾¹å—ï¼Ÿ",ans:"Could we sit by the window , please ?"}
];

const CARDS=[
 {front:"give sb a ride",back:"è½½æŸäººä¸€ç¨‹ï¼ˆç¾å¼ï¼‰"},
 {front:"run into / bump into",back:"å¶é‡æŸäººï¼ˆå£è¯­ï¼‰"},
 {front:"go/come over",back:"ï¼ˆå£è¯­ï¼‰è·¨è¿‡å»/è¿‡æ¥ï¼›go over to Japan"},
 {front:"head out",back:"å‡ºå‘ã€åŠ¨èº«ï¼ˆå¼ºè°ƒç¦»å¼€èµ·ç‚¹ï¼‰"},
 {front:"go on / take a trip",back:"å»æ—…è¡Œï¼ˆå¸¸ç”¨ã€é€šç”¨ï¼‰"},
 {front:"though / even though",back:"è™½ç„¶ï¼›even though è¯­æ°”æ›´å¼º"},
 {front:"homeï¼ˆå‰¯è¯ï¼‰",back:"go/drive/take sb homeï¼Œä¸åŠ  to"},
 {front:"drop sb off",back:"æŠŠæŸäººé€åˆ°æŸåœ°ï¼ˆè®©ä»–ä¸‹è½¦ï¼‰"},
 {front:"pick sb up",back:"å»æ¥æŸäººï¼ˆé¡ºè·¯/çº¦å®šï¼‰"},
 {front:"I'll have ...",back:"ï¼ˆç‚¹é¤ï¼‰æˆ‘è¦â€¦â€¦ï¼ˆç¤¼è²Œè‡ªç„¶ï¼‰"}
];

const DIALOGS={
 travel:[
  {en:"Excuse me, whereâ€™s the check-in counter for Japan Airlines?",cn:"æ‰“æ‰°ä¸€ä¸‹ï¼Œæ—¥æœ¬èˆªç©ºçš„å€¼æœºæŸœå°åœ¨å“ªé‡Œï¼Ÿ"},
  {en:"Could you help me print the boarding pass?",cn:"å¯ä»¥å¸®æˆ‘æ‰“å°ç™»æœºç‰Œå—ï¼Ÿ"},
  {en:"How many bags are you checking?",cn:"æ‚¨è¦æ‰˜è¿å‡ ä¸ªè¡Œæï¼Ÿ"},
  {en:"Just one. Also, can I keep this power bank in my carry-on?",cn:"å°±ä¸€ä¸ªã€‚å¦å¤–ï¼Œè¿™ä¸ªå……ç”µå®å¯ä»¥éšèº«å¸¦å—ï¼Ÿ"}
 ],
 smalltalk:[
  {en:"Hey, long time no see! Guess who I ran into yesterday?",cn:"å˜¿ï¼Œå¥½ä¹…ä¸è§ï¼çŒœçŒœæˆ‘æ˜¨å¤©å¶é‡äº†è°ï¼Ÿ"},
  {en:"No wayâ€”who?",cn:"ä¸ä¼šå§â€”â€”è°ï¼Ÿ"},
  {en:"Prepper. She waved at me and called out my name.",cn:"Prepperã€‚å¥¹æœæˆ‘æŒ¥æ‰‹ï¼Œè¿˜å–Šäº†æˆ‘çš„åå­—ã€‚"},
  {en:"Nice! Did you guys catch up?",cn:"ä¸é”™ï¼ä½ ä»¬èŠäº†èŠå—ï¼Ÿ"}
 ],
 restaurant:[
  {en:"Table for two, please.",cn:"æˆ‘ä»¬ä¸¤ä½ã€‚"},
  {en:"Could we sit by the window?",cn:"æˆ‘ä»¬å¯ä»¥åçª—è¾¹å—ï¼Ÿ"},
  {en:"Iâ€™ll have the chicken, and sheâ€™ll take the salad.",cn:"æˆ‘è¦é¸¡è‚‰ï¼Œå¥¹è¦æ²™æ‹‰ã€‚"},
  {en:"Can we get the check, please?",cn:"å¯ä»¥ç»“è´¦å—ï¼Ÿ"}
 ],
 work:[
  {en:"I replied to my bossâ€™s email yesterday afternoon.",cn:"æˆ‘æ˜¨å¤©ä¸‹åˆå›å¤äº†è€æ¿çš„é‚®ä»¶ã€‚"},
  {en:"Could you drop by my desk later?",cn:"ä½ å¾…ä¼šå„¿èƒ½åˆ°æˆ‘å·¥ä½æ¥ä¸€ä¸‹å—ï¼Ÿ"},
  {en:"Letâ€™s head out after the meeting.",cn:"å¼€å®Œä¼šæˆ‘ä»¬å°±èµ°å§ã€‚"},
  {en:"Sounds good. Iâ€™ll catch up with you there.",cn:"å¥½ï¼Œåˆ°é‚£è¾¹å†æ‰¾ä½ ã€‚"}
 ]
};

// MC
let mcIdx=S.mcIdx||0, mcRight=S.mcRight||0, mcTotal=S.mcTotal||0;
const mcQ=document.getElementById("mcQ"), mcOpts=document.getElementById("mcOpts"), mcHint=document.getElementById("mcHint");
const mcRightEl=document.getElementById("mcRight"), mcTotalEl=document.getElementById("mcTotal");
function renderMC(){const item=MC[mcIdx%MC.length]; mcQ.textContent="Q: "+item.q; mcOpts.innerHTML=""; mcHint.textContent="";
  item.opts.forEach((t,i)=>{const btn=document.createElement("button"); btn.className="opt"; btn.textContent=t;
    btn.onclick=()=>{const ok=i===item.answer; btn.classList.add(ok?"correct":"wrong"); mcHint.textContent=(ok?"âœ… æ­£ç¡®ã€‚":"âŒ å†æƒ³æƒ³ã€‚")+" è§£é‡Šï¼š"+item.why; mcTotal++; if(ok) mcRight++; mcRightEl.textContent=mcRight; mcTotalEl.textContent=mcTotal; S.mcRight=mcRight; S.mcTotal=mcTotal; save(); mcOpts.querySelectorAll("button").forEach(b=>b.disabled=true);};
    mcOpts.appendChild(btn);});
  mcRightEl.textContent=mcRight; mcTotalEl.textContent=mcTotal;}
document.getElementById("mcNext").onclick=()=>{mcIdx++; S.mcIdx=mcIdx; save(); renderMC();}; renderMC();

// ORDER
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a;}
let odIdx=S.odIdx||0, odRight=S.odRight||0, odTotal=S.odTotal||0;
const odQ=document.getElementById("odQ"), odDrop=document.getElementById("odDrop"), odPool=document.getElementById("odPool");
const odRightEl=document.getElementById("odRight"), odTotalEl=document.getElementById("odTotal"), odHint=document.getElementById("odHint");
function renderOD(){const item=ORDER[odIdx%ORDER.length]; odQ.textContent="Q: "+item.q; odDrop.innerHTML=""; odHint.textContent="";
  const toks=item.ans.split(" ").filter(x=>x.length); const pool=shuffle(toks.slice()); odPool.innerHTML="";
  pool.forEach(t=>{const p=document.createElement("button"); p.className="pill"; p.textContent=t;
    p.onclick=()=>{if(p.classList.contains("sel")){const m=Array.from(odDrop.children).find(x=>x.dataset.id===p.dataset.id); if(m) m.remove(); p.classList.remove("sel");}
      else{const s=document.createElement("span"); s.className="pill sel"; s.textContent=t; s.dataset.id=p.dataset.id=Math.random().toString(36).slice(2); odDrop.appendChild(s); p.classList.add("sel");}};
    odPool.appendChild(p);}); odRightEl.textContent=odRight; odTotalEl.textContent=odTotal;}
document.getElementById("odCheck").onclick=()=>{const item=ORDER[odIdx%ORDER.length]; const guess=Array.from(odDrop.children).map(x=>x.textContent).join(" "); const ok=guess===item.ans; odHint.textContent=ok?"âœ… å®Œç¾ï¼":"âŒ æ­£ç¡®ç­”æ¡ˆï¼š"+item.ans; odTotal++; if(ok) odRight++; odRightEl.textContent=odRight; odTotalEl.textContent=odTotal; S.odRight=odRight; S.odTotal=odTotal; save();};
document.getElementById("odNext").onclick=()=>{odIdx++; S.odIdx=odIdx; save(); renderOD();}; renderOD();

// CARDS
let fcIdx=S.fcIdx||0, known=S.known||{}; const fcFront=document.getElementById("fcFront"), fcBack=document.getElementById("fcBack"), fcKnown=document.getElementById("fcKnown");
function renderFC(){const item=CARDS[fcIdx%CARDS.length]; fcFront.textContent=item.front; fcBack.textContent=item.back; fcBack.style.display="none"; fcKnown.textContent=Object.values(known).filter(Boolean).length;}
document.getElementById("fcFlip").onclick=()=>{fcBack.style.display=(fcBack.style.display==="none"?"":"none");};
document.getElementById("fcUnsure").onclick=()=>{known[CARDS[fcIdx%CARDS.length].front]=false; S.known=known; save(); fcIdx++; S.fcIdx=fcIdx; save(); renderFC();};
document.getElementById("fcKnow").onclick=()=>{known[CARDS[fcIdx%CARDS.length].front]=true; S.known=known; save(); fcIdx++; S.fcIdx=fcIdx; save(); renderFC();}; renderFC();

// DIALOGS + TTS
const dlgBox=document.getElementById("dlgBox"); const dlgScene=document.getElementById("dlgScene"); const accentSel=document.getElementById("accent");
function renderDlg(){dlgBox.innerHTML=""; const arr=DIALOGS[dlgScene.value]; arr.forEach(line=>{const div=document.createElement("div"); div.className="card"; div.innerHTML="<b>"+line.en+"</b><div class='muted'>"+line.cn+"</div>"; dlgBox.appendChild(div);});}
renderDlg(); dlgScene.onchange=renderDlg;
document.getElementById("dlgPlay").onclick=()=>{const arr=DIALOGS[dlgScene.value]; const utter=t=>{const u=new SpeechSynthesisUtterance(t); u.rate=1.0; u.pitch=1.0; u.lang=accentSel.value==="us"?"en-US":"en-GB"; speechSynthesis.speak(u);}; arr.forEach((line,i)=>{setTimeout(()=>utter(line.en),i*1500);});};

// Shadow record
const shLine=document.getElementById("shLine"); const shSpeak=document.getElementById("shSpeak"); const shRecord=document.getElementById("shRecord"); const shStop=document.getElementById("shStop"); const shAudio=document.getElementById("shAudio"); const shDownload=document.getElementById("shDownload");
shSpeak.onclick=()=>{const u=new SpeechSynthesisUtterance(shLine.textContent); u.lang="en-US"; speechSynthesis.speak(u);};
let mediaRec, chunks=[];
shRecord.onclick=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({audio:true}); mediaRec=new MediaRecorder(stream); chunks=[]; mediaRec.ondataavailable=e=>chunks.push(e.data);
  mediaRec.onstop=()=>{const blob=new Blob(chunks,{type:"audio/webm"}); const url=URL.createObjectURL(blob); shAudio.src=url; shAudio.style.display=""; shDownload.href=url; shDownload.download="shadow.webm"; shDownload.style.display="inline-block";};
  mediaRec.start(); shRecord.disabled=True; shStop.disabled=False;}catch(e){alert("å½•éŸ³å¤±è´¥ï¼ˆæµè§ˆå™¨æœªæˆæƒ/ä¸æ”¯æŒï¼‰ã€‚");}};
shStop.onclick=()=>{if(mediaRec && mediaRec.state!=="inactive"){mediaRec.stop(); shRecord.disabled=False; shStop.disabled=True;}};

// Settings
document.getElementById("reset").onclick=()=>{if(confirm("æ¸…ç©ºæ‰€æœ‰è¿›åº¦ï¼Ÿ")){localStorage.removeItem(storeKey); location.reload();}};
</script>
</body>
</html>
